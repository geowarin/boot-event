<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <title>The HTML5 Herald</title>
    <meta name="description" content="The HTML5 Herald">
    <meta name="author" content="SitePoint">
</head>

<body>
<!--<script src="js/eventsource.js"></script>-->
<script>
    var eventSource = new EventSource("/events");

    function createDiv(message) {
        var div = document.createElement("div");
        div.appendChild(document.createTextNode(message));
        document.body.appendChild(div);
    }

    var onMessage = function (event) {
        var message = 'message : ' + event.data;
        createDiv(message);
    };
    var onOpen = function(e) {
        createDiv('open');
    };
    var onError = function(event) {
        var message = event.eventPhase == EventSource.CLOSED ? 'closed' : 'error';
        createDiv(message);
    };

    var onTruc = function(event) {
        console.log('TRUC');
        createDiv(event.type + ': ' +event.data);
    };

    eventSource.addEventListener("open", onOpen);
    eventSource.addEventListener("message", onMessage);
    eventSource.addEventListener("truc", onTruc);
    eventSource.addEventListener("error", onError);
</script>
</body>
</html>